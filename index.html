<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä»‹è­·äº‹æ¥­æ‰€ ç©ºãçŠ¶æ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", Arial, sans-serif; margin: 24px; line-height: 1.7; }
    header { margin-bottom: 16px; }
    h1 { font-size: 1.4rem; margin: 0; }
    .desc { color: #555; margin-top: 4px; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px 16px; margin: 12px 0; background: #fafafa; }
    .title { font-weight: 600; font-size: 1.1rem; margin-bottom: 6px; }
    .updated { font-size: .85rem; color: #666; }
    .error { color: #b00020; }
    .toolbar { display: flex; gap: 8px; align-items: center; margin: 12px 0; }
    button { padding: 6px 10px; border: 1px solid #ccc; border-radius: 6px; background: #fff; cursor: pointer; }
    button:hover { background: #f3f3f3; }
  </style>
</head>
<body>

<header>
  <h1>ğŸ“‹ ä»‹è­·äº‹æ¥­æ‰€ ç©ºãçŠ¶æ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
  <p class="desc">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å‹Ÿé›†çŠ¶æ³ã‚’ç¢ºèªãƒ»æ›´æ–°ï¼ˆæ›´æ–°ã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§å®Ÿæ–½ï¼‰</p>
  <nav class="desc">ğŸ‘ï¸ ç¢ºèªï¼ˆã‚±ã‚¢ãƒãƒã‚¸ãƒ£ãƒ¼å‘ã‘ï¼‰ã€€âœï¸ å…¥åŠ›ï¼ˆäº‹æ¥­æ‰€å‘ã‘ï¼‰ã€€ğŸ“ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç©ºãçŠ¶æ³</nav>
</header>

<section class="toolbar">
  <button id="reloadBtn">æœ€æ–°æƒ…å ±ã‚’å†å–å¾—</button>
  <span id="status"></span>
</section>

<div id="content"></div>
<p id="error" class="error" hidden></p>

<script>
  // â‘  ã“ã®URLã‚’ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œã‚¦ã‚§ãƒ–ã«å…¬é–‹ï¼ˆCSVï¼‰ã€ã®URLã«å·®ã—æ›¿ãˆã¦ãã ã•ã„
  // ä¾‹: https://docs.google.com/spreadsheets/d/XXXXXXXXXXXX/pub?output=csv
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQGV8SeToaI7L1lucDfze36mZZCRWWFTICTIwik5yfK-cv_CN1xnN0D9lCjKn72ijknDLnUrJqPVgAa/pub?output=csv";

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã®ãŸã‚ã®ã‚¯ã‚¨ãƒªï¼ˆæ¯å›é•ã†å€¤ã‚’ä»˜ã‘ã‚‹ï¼‰
  const cacheBuster = () => `cb=${Date.now()}`;

  async function fetchCsv(url) {
    const res = await fetch(`${url}&${cacheBuster()}`, { cache: "no-store" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return await res.text();
  }

  // CSVã‚’é…åˆ—ã«å¤‰æ›ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªCSVæƒ³å®šï¼‰
  function parseCsv(text) {
    // æ”¹è¡Œã§è¡Œåˆ†å‰²ã€ã‚«ãƒ³ãƒã§åˆ—åˆ†å‰²
    const rows = text.trim().split(/\r?\n/).map(line => {
      // ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã¾ã‚ŒãŸã‚«ãƒ³ãƒã‚’è€ƒæ…®ã™ã‚‹ç°¡æ˜“ãƒ‘ãƒ¼ã‚µ
      const out = []; let cur = ""; let inQuote = false;
      for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch === '"') {
          if (inQuote && line[i+1] === '"') { cur += '"'; i++; }  // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸã‚¯ã‚©ãƒ¼ãƒˆ
          else { inQuote = !inQuote; }
        } else if (ch === ',' && !inQuote) {
          out.push(cur); cur = "";
        } else {
          cur += ch;
        }
      }
      out.push(cur);
      return out;
    });
    const [header, ...data] = rows;
    const idxTitle = header.indexOf("title");
    const idxBody  = header.indexOf("body");
    return data.map(r => ({ title: r[idxTitle] ?? "", body: r[idxBody] ?? "" }));
  }

  function render(items) {
    const container = document.getElementById("content");
    container.innerHTML = "";
    items.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";
      const h = document.createElement("div");
      h.className = "title";
      h.textContent = item.title || "ï¼ˆç„¡é¡Œï¼‰";
      const p = document.createElement("div");
      p.innerHTML = (item.body || "").replace(/\n/g, "<br>");
      const meta = document.createElement("div");
      meta.className = "updated";
      const now = new Date();
      meta.textContent = `æœ€çµ‚å–å¾—: ${now.toLocaleString()}`;
      card.appendChild(h);
      card.appendChild(p);
      card.appendChild(meta);
      container.appendChild(card);
    });
  }

  async function load() {
    const status = document.getElementById("status");
    const error  = document.getElementById("error");
    error.hidden = true;
    status.textContent = "å–å¾—ä¸­â€¦";
    try {
      const csvText = await fetchCsv(CSV_URL);
      const items = parseCsv(csvText);
      render(items);
      status.textContent = "æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºä¸­";
    } catch (e) {
      console.error(e);
      error.hidden = false;
      error.textContent = "ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å…¬é–‹URLã‚„æ¨©é™è¨­å®šã‚’ã”ç¢ºèªãã ã•ã„ã€‚";
      status.textContent = "";
    }
  }

  document.getElementById("reloadBtn").addEventListener("click", load);
  load(); // åˆå›ãƒ­ãƒ¼ãƒ‰
</script>

</body>

